<h1 class="inline">
	<%= @command.name %>
</h1>
<% if logged_in? %>
	<ul class="options header">
		<% if current_user.is_admin? %>
			<li class="edit"><%= link_to 'Edit this Command', edit_command_path(@command) %></li>
		<% end %>
		<% unless @command.created_by?(current_user) %>
			<li class="add"><%= link_to 'Copy', copy_user_command_path(:id=>@command.id, :is_command=>true) %></li>
		<% end %>
	</ul>
<% end %>

<hr />
<p class="small-url">
	<%= @command.url.ellipsize(:max => 150, :delimiter => " . . . . . ") %>
</p>

<div id="primary">
		<div style="margin: 20px 0px">
			<h2>Description</h2>
			<div id="command_description_box">
				<%= textilize_without_paragraph @command.description || 'No description yet.' %>
			</div>
		</div>
		
		<h2>
			Public Queries
			<%= "(Last #{@queries.size})" %>
		</h2>

		<table>
		  <tr>
		    <th>Query</th>
		    <th>Date</th>
		  </tr>		
		
			<% for query in @queries %>
				<tr <%= cycle('class="offset"', '') -%>>
				  <td><%= link_to_query query %></td>
				  <td><%= time_ago_in_words_or_date query.created_at %></td>
				</tr>
			<% end %>
		</table>
		<p><%= link_to "View all queries", command_queries_path(@command), :class => "faded"  %></p>
</div>


<div id="secondary">
	
	<h2>
		<%= render_favicon_for_command @command %>
		About this Command
	</h2>
	<p>Created by <%= link_to @command.user.login, user_home_path(@command.user)%> on <%= @command.created_at.to_s(:medium)%>.</p>
	
	<p><b>Keyword:</b> <%=h @command.keyword %></p>
	
	<p><b>Kind:</b> <%=h @command.kind %> <%= "(uses POST)" if @command.http_post? %></p>
	
	<p><b>Visible to Public:</b> <%= @command.public? ? "Yes" : "No" %></p>
	<p><b>Number of Users:</b> <%= @command.users.size %></p>
		
	<p><b>Total Queries:</b> <%= @command.queries_count_all %></p>
	
	<% if @command.public? && ! @user_commands.empty? %>
		<h2>Top User Commands</h2>
		<table>
		  <tr>
		    <th>User</th>
		    <th>User Command</th>
			<th>queries</th>
		  </tr>		
	
			<% for usercommand in @user_commands %>
				<tr <%= cycle('class="offset"', '') -%>>
				  <td><%= link_to usercommand.user.login, user_home_path(usercommand.user) %></td>
				  <td>
					<%= render_favicon_for_command usercommand %>
					<%= link_to usercommand.name, public_user_command_path(usercommand)  %>
				  </td>
				  <td><%= usercommand.queries_count %></td>
				</tr>
			<% end %>
		</table>
		<p><%= link_to "View all user commands", command_user_commands_path(@command), :class => "faded"  %></p>
	
	<% end %>
	<% if false %>
		<h2>Tags</h2>
		<%= tag_cloud @command.tags %>
		<!-- <p><b>Tags:</b> <%# @command.tag_string.split(" ").map{|tag| "<a href=''>#{tag}</a>"}.join(" ") %></p>	 -->
	<% end %>

	
</div>