<h1 class="inline">
	<% if current_page_matches?(search_user_commands_path(current_user)) || current_page_matches?(search_all_commands_path) %>
		Search Results for '<%= params[:q] %>'
	<% else %>
		<%= @commands.empty? ? 'No' : (@user ? whose_commands(@commands.first) : "All") %> commands
		<%= "tagged with '#{@tags.join("+").gsub("+", "' and '")}'" unless @tags.blank? %>
	<% end %>
</h1>

<ul class="bolder options header">
	<% if logged_in? && @user != current_user %>
		<li class="search"><%= link_to 'Yours', (@tags.blank? ? user_commands_path(current_user) : user_tagged_commands_path(current_user, @tags)) %></li>
	<% end %>
	<% if @user %>
		<li class="search"><%= link_to 'All', (@tags.blank? ? commands_path : tagged_commands_path(@tags)) %></li>
	<% end %>
</ul>


<hr />

<table class="top_spaced">
  <tr>
    <th>Name</th>
    <th width="30" class="centered"><b>Hits</b></th>
    <th width="70">Keyword</th>
    <th><%= @user ? "Last Used" : "User" %></th>
		<th>Options</th>
  </tr>
 
<% for command in @commands %>
	<tr <%= cycle('class="offset"', '') -%>>
    <td>
			<p class="command_title">
				<%= render_favicon_for_command command %>
				<%= link_to command.name, command_show_path(command), :title=>command.url, :class => "iconed" %>
			</p>
			<p class="tag_list">Tags: <%= command.tags.map{|t| link_to(t.name, user_tagged_commands_path(command.user,t.name)) }.join(" ") %></p>
		</td>
    <td class="centered <%= "faded" if command.queries.size == 0 %>"><%= command.queries.size %></td>	
    <td class="centered"><%= command.keyword %></td>
    <td>
			<% if @user %>
				<%= command.queries.size > 0 ? time_ago_in_words_or_date(command.queries.last.created_at) : link_to("(Unused)", command_show_path(command), :class => "faded") %>
			<% else %>
				<%= link_to command.user.login, user_home_path(command.user) %>
			<% end %>
		</td>	
		<td>
		<% if logged_in? %>
			<ul class="options">
				<% if current_user_owns_command? command %>
					<li class="no_icon"><%= link_to image_tag("icons/edit.png"), command_edit_path(command) %></li>
					<li class="no_icon"><%= link_to image_tag("icons/delete.png"), command_delete_path(command), :confirm => "Are you sure you want to delete this command?", :method => :delete  %></li>
				<% else %>
					<li class="add"><%= link_to 'Copy', new_command_path({:ancestor => command.id}) %></li>
				<% end %>				
			</ul>
		<% end %>
		</td>
  </tr>
<% end %>
</table>

<%= will_paginate @commands %>