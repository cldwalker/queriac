<%- title = set_breadcrumb_title; title += " - " + sort_description if params[:sort]; set_header :title=>title -%>
<% if logged_in? %>
	<div style="float: right">
	<% form_tag search_user_commands_path, :method=>:get  do %>
	<label for="q">Search your user commands by url or keyword</label>
		<%= text_field_tag 'q' %>
		<%= submit_tag 'Search' %>
	<% end %>
	</div>
<% end %>
<h1 class="inline">
	<% if current_page_matches?(search_user_commands_path) || current_page_matches?(search_all_commands_path) %>
		Search Results for '<%= params[:q] %>'
	<% else %>
		<%= @user_commands.empty? ? 'No' : (@user ? whose_commands(@user_commands.first) : "All") %> 
		<%= 'and private' if admin? && @user && ! current_user? %> 
		<%= link_to @command.keyword, command_path(@command) if @command %>
		user commands
		<%= sort_description if params[:sort ]%>
		<%= "tagged with '#{@tags.join("+").gsub("+", "' and '")}'" unless @tags.blank? %>
	<% end %>
	<span class="pagination_description">(<%= pagination_description @user_commands %>)</span>
</h1>

<ul class="bolder options header">
	
	<% if logged_in? && ! current_user? %>
		<li class="search"><%= link_to 'Yours', (@tags.blank? ? specific_user_commands_path(current_user) : tagged_user_commands_path(current_user, @tags)) %></li>
	<% end %>
	<% if @user %>
		<% if @tags.blank? %>
			<%# Hiding all tagged user_commands interface %>
			<!-- <li class="search"><%# link_to 'All', (@tags.blank? ? user_commands_path : all_tagged_user_commands_path(@tags)) %></li> -->
			<li class="search"><%= link_to 'All', user_commands_path %></li>
		<% end %>
		<% if @tags %>
		<li><%= link_to "Queries for these commands", user_tagged_queries_path(@user, @tags)%></li>
		<% end %>
	<% end %>
</ul>


<hr />

<table class="top_spaced">
  <tr>
    <th>User Command<br/>
		<%= sort_link_up 'name'%>
		<%= sort_link_down 'name'%>
	</th>
	<th width="150">Command</th>
    <th width="30" class="centered">Queries<br/>
		<%= sort_link_up 'queries_count' %>
		<%= sort_link_down 'queries_count' %>
	</th>
    <th width="70">Keyword<br/>
		<%= sort_link_up 'keyword'%>
		<%= sort_link_down 'keyword'%>
	</th>
    <th><%= "User" %></th>
	<th>Created<br/>
		<%= sort_link_up 'created_at'%>
		<%= sort_link_down 'created_at'%>
	</th>
	<th>Options</th>
  </tr>
 
<% for uc in @user_commands %>
	<tr <%= cycle('class="offset"', '') -%>>
    <td>
			<p class="command_title">
				<%= user_command_link uc %>
			</p>
			<p class="tag_list">Tags: <%= uc.tags.map{|t| link_to(t.name, tagged_user_commands_path(uc.user,t.name)) }.join(" ") %></p>
	</td>
	<td>
		<p class="command_title">
			<%= basic_command_link uc.command %>
		</p>
	</td>
    <td class="centered <%= "faded" if uc.queries_count == 0 %>"><%= uc.queries_count %></td>	
    <td class="centered"><%= uc.keyword %></td>
    <td>
		<% if false #@user %>
			<%# PERF: too expensive for now %>
			<%# uc.queries_count > 0 ? time_ago_in_words_or_date(uc.queries.find(:first, :select=>'created_at').created_at) : link_to("(Unused)", command_path(command), :class => "faded") %>
		<% else %>
			<%= user_link uc.user %>
		<% end %>
	</td>
	<td>
		<%= time_ago_in_words_or_date(uc.created_at) %>
	</td>		
	<td>
		<%= command_actions(uc)%>
	</td>
  </tr>
<% end %>
</table>

<%= will_paginate @user_commands %>